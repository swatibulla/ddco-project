<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DDCO Escape Room</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1a3e 50%, #0d0f2d 100%);
      background-attachment: fixed;
      color: #cfeee7;
      text-align: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(0, 200, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 123, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(0, 255, 176, 0.08) 0%, transparent 50%);
      z-index: -2;
      pointer-events: none;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(0deg, transparent 24%, rgba(0, 200, 255, 0.05) 25%, rgba(0, 200, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 200, 255, 0.05) 75%, rgba(0, 200, 255, 0.05) 76%, transparent 77%, transparent),
        linear-gradient(90deg, transparent 24%, rgba(0, 200, 255, 0.05) 25%, rgba(0, 200, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 200, 255, 0.05) 75%, rgba(0, 200, 255, 0.05) 76%, transparent 77%, transparent);
      background-size: 50px 50px;
      z-index: -1;
      pointer-events: none;
    }

    h1 {
      margin-top: 10px;
      font-size: 48px;
      color: #00ffff;
      text-shadow: 
        0 0 10px rgba(0, 255, 255, 0.5),
        0 0 20px rgba(0, 200, 255, 0.3),
        0 0 30px rgba(255, 0, 200, 0.2);
      letter-spacing: 2px;
      animation: glowPulse 2s ease-in-out infinite;
    }

    @keyframes glowPulse {
      0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 20px rgba(0, 200, 255, 0.3), 0 0 30px rgba(255, 0, 200, 0.2); }
      50% { text-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 40px rgba(0, 200, 255, 0.6), 0 0 60px rgba(255, 0, 200, 0.4); }
    }

    #timer {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 28px;
      font-weight: 700;
      color: #00ff00;
      background: rgba(0, 0, 0, 0.9);
      padding: 12px 20px;
      border-radius: 10px;
      border: 3px solid #00ff00;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.5), inset 0 0 10px rgba(0, 255, 0, 0.2);
      z-index: 999;
      font-family: 'Courier New', monospace;
    }

    #timer.warning {
      color: #ffff00;
      border-color: #ffff00;
      box-shadow: 0 0 20px rgba(255, 255, 0, 0.5), inset 0 0 10px rgba(255, 255, 0, 0.2);
    }

    #timer.danger {
      color: #ff0000;
      border-color: #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.7), inset 0 0 10px rgba(255, 0, 0, 0.3);
      animation: blink 0.5s infinite;
    }

    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

    .intro-screen {
      margin: 30px auto;
      padding: 40px;
      border: 3px solid #00e5ff;
      background: linear-gradient(135deg, rgba(0, 229, 255, 0.08), rgba(255, 123, 255, 0.04));
      border-radius: 15px;
      font-size: 18px;
      line-height: 1.8;
      width: 92%;
      max-width: 900px;
      box-shadow: 
        0 0 30px rgba(0, 229, 255, 0.3),
        inset 0 0 20px rgba(0, 229, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .intro-screen p {
      margin: 12px 0;
    }

    .start-button {
      margin-top: 25px;
      padding: 15px 40px;
      font-size: 20px;
      background: linear-gradient(135deg, #00e5ff, #00c6ff);
      color: #000;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 0 20px rgba(0, 229, 255, 0.4);
      transition: all 0.3s ease;
    }

    .start-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(0, 229, 255, 0.6);
    }

    .game-container { display: none; margin-top: 20px; }

    #game {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      backdrop-filter: blur(5px);
    }

    .door {
      width: 160px;
      height: 130px;
      padding: 12px;
      border: 3px solid #ffb86b;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      background: linear-gradient(135deg, #1a2332, #0a1420);
      border-radius: 12px;
      font-size: 18px;
      color: #ffe8c9;
      box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.6),
        inset 0 0 15px rgba(255, 184, 107, 0.1);
      transition: all 0.3s ease;
      position: relative;
    }

    .door::before {
      content: 'üîí';
      position: absolute;
      top: 5px;
      right: 8px;
      font-size: 16px;
    }

    .door:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 15px 35px rgba(255, 184, 107, 0.3), inset 0 0 15px rgba(255, 184, 107, 0.2);
    }

    .door.hidden { display: none; }

    .door.unlocked {
      background: linear-gradient(135deg, #0af3a3, #02785f);
      color: #000;
      border-color: #00ffb3;
      box-shadow: 
        0 8px 25px rgba(0, 255, 176, 0.4),
        inset 0 0 15px rgba(0, 255, 176, 0.2);
      transform: none;
      cursor: default;
    }

    .door.unlocked::before {
      content: 'üîì';
      animation: unlock 0.6s ease;
    }

    @keyframes unlock {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(-20deg); }
      100% { transform: rotate(-30deg); }
    }

    .door small {
      font-size: 12px;
      opacity: 0.8;
    }

    #message {
      margin-top: 20px;
      font-size: 18px;
      min-height: 50px;
      padding: 15px;
      background: rgba(0, 229, 255, 0.1);
      border-left: 4px solid #00e5ff;
      border-radius: 5px;
      color: #ffff00;
      font-weight: 500;
    }

    #keys {
      margin-top: 20px;
      font-size: 18px;
      color: #ffd36b;
      padding: 15px;
      background: rgba(255, 211, 107, 0.1);
      border-radius: 10px;
    }

    .key-icon {
      display: inline-block;
      margin: 0 8px;
      font-size: 24px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .npc {
      position: fixed;
      left: 20px;
      bottom: 20px;
      background: linear-gradient(135deg, rgba(3, 18, 26, 0.95), rgba(10, 30, 40, 0.9));
      color: #dff9f3;
      border: 2px solid #00c6ff;
      padding: 18px;
      border-radius: 12px;
      max-width: 340px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7), 0 0 20px rgba(0, 198, 255, 0.3);
      display: none;
      z-index: 200;
      backdrop-filter: blur(10px);
    }

    .npc::before {
      content: 'ü§ñ';
      display: block;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .npc h4 { margin: 0 0 8px 0; font-size: 16px; color: #bff7ff; text-transform: uppercase; letter-spacing: 1px; }

    .npc p { margin: 0; font-size: 14px; color: #eafefb; line-height: 1.5; }

    .npc .close { margin-top: 10px; display: block; text-align: right; font-size: 13px; color: #9be8ff; cursor: pointer; }

    .pulse { animation: pulse 1.2s infinite; }

    @keyframes pulse {
      0% { box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6), inset 0 0 15px rgba(255, 184, 107, 0.1), 0 0 15px rgba(255, 184, 107, 0.2); }
      50% { box-shadow: 0 8px 25px rgba(255, 184, 107, 0.3), inset 0 0 15px rgba(255, 184, 107, 0.2), 0 0 30px rgba(255, 184, 107, 0.4); }
      100% { box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6), inset 0 0 15px rgba(255, 184, 107, 0.1), 0 0 15px rgba(255, 184, 107, 0.2); }
    }

    .exit-door {
      margin-top: 25px;
      padding: 25px;
      border: 3px dashed #ff7bff;
      background: linear-gradient(135deg, rgba(255, 123, 255, 0.08), rgba(255, 0, 200, 0.04));
      border-radius: 12px;
      font-size: 22px;
      display: none;
      cursor: pointer;
      box-shadow: 0 0 30px rgba(255, 123, 255, 0.3);
      transition: all 0.3s ease;
      font-weight: 700;
    }

    .exit-door:hover {
      transform: scale(1.05);
      box-shadow: 0 0 50px rgba(255, 123, 255, 0.6);
    }

    .victory-screen {
      display: none;
      padding: 40px;
      margin-top: 20px;
      border: 3px solid #ffd36b;
      border-radius: 15px;
      background: linear-gradient(135deg, rgba(255, 211, 107, 0.1), rgba(255, 123, 255, 0.1));
      color: #fff;
      box-shadow: 0 0 40px rgba(255, 211, 107, 0.4);
    }

    .victory-screen h3 {
      color: #ffff00;
      font-size: 36px;
      margin-bottom: 15px;
      text-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
    }

    .timeout-screen {
      display: none;
      padding: 40px;
      margin-top: 20px;
      border: 3px solid #ff0000;
      border-radius: 15px;
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 0, 0, 0.05));
      color: #ff0000;
      text-align: center;
      box-shadow: 0 0 40px rgba(255, 0, 0, 0.4);
    }

    .timeout-screen h3 {
      font-size: 36px;
      animation: blink 0.6s infinite;
    }

    .room-title {
      margin: 20px 0 10px 0;
      font-size: 24px;
      color: #00e5ff;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
    }

    /* Image Puzzle Modal */
    .image-puzzle-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 300;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
    }

    .image-puzzle-modal.show {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(10, 14, 39, 0.98), rgba(26, 26, 62, 0.98));
      padding: 30px;
      border-radius: 15px;
      border: 3px solid #00e5ff;
      max-width: 700px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(0, 229, 255, 0.4);
    }

    .modal-content h3 {
      color: #00ffff;
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
    }

    .modal-image {
      max-width: 100%;
      border-radius: 10px;
      margin: 20px 0;
      border: 2px solid #ffb86b;
      box-shadow: 0 0 20px rgba(255, 184, 107, 0.3);
    }

    .modal-question {
      color: #ffff00;
      font-size: 18px;
      margin: 20px 0;
      font-weight: 600;
    }

    .modal-input {
      padding: 12px;
      width: 90%;
      border-radius: 6px;
      border: 2px solid #00e5ff;
      background: rgba(0, 229, 255, 0.1);
      color: #cfeee7;
      font-size: 16px;
      margin: 15px 0;
      text-align: center;
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    .modal-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .modal-submit {
      background: linear-gradient(135deg, #00ff88, #00cc66);
      color: #000;
    }

    .modal-submit:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
    }

    .modal-close {
      background: linear-gradient(135deg, #ff3333, #cc0000);
      color: #fff;
    }

    .modal-close:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
    }
  </style>
</head>
<body>
  <h1>üîê DDCO ESCAPE ROOM üîê</h1>

  <div id="timer">‚è±Ô∏è 15:00</div>

  <div class="intro-screen" id="introScreen">
    <p><strong style="color: #00ffff; font-size: 24px;">‚ö° Welcome to the Digital Logic Escape Room ‚ö°</strong></p>
    <p>You are trapped inside a high-tech laboratory filled with mysterious circuit boards, binary puzzles, and digital mazes. The only way out is to unlock all 15 doors by solving DDCO (Digital Design & Computer Organization) riddles.</p>
    <p><strong>15 Doors ‚Ä¢ 15 Puzzles (Text + Image) ‚Ä¢ 15 Keys ‚Ä¢ 15 Minutes ‚è±Ô∏è</strong></p>
    <p>Analyze logic gates, decode binary sequences, understand flip-flops, and master digital concepts through both text and visual puzzles. Each correct answer unlocks a door and reveals the location of the next challenge.</p>
    <p style="color: #ff7bff; font-size: 16px;">‚ö†Ô∏è The timer is running. Can you escape before time runs out? ‚ö†Ô∏è</p>
    <button class="start-button" onclick="startGame()">üö™ ENTER THE LAB</button>
  </div>

  <div class="game-container" id="gameContainer">
    <div class="room-title">üì° CIRCUIT LABORATORY üì°</div>
    
    <div id="game">
      <div id="door1" class="door" onclick="onDoorClick(1)"><div>üö™ DOOR 1</div><small>Binary Corner</small></div>
      <div id="door2" class="door hidden" onclick="onDoorClick(2)"><div>üö™ DOOR 2</div><small>Logic Shelf</small></div>
      <div id="door3" class="door hidden" onclick="onDoorClick(3)"><div>üö™ DOOR 3</div><small>Flip-Flop Wall</small></div>
      <div id="door4" class="door hidden" onclick="onDoorClick(4)"><div>üö™ DOOR 4</div><small>Instruction Nook</small></div>
      <div id="door5" class="door hidden" onclick="onDoorClick(5)"><div>üö™ DOOR 5</div><small>ALU Bench</small></div>
      <div id="door6" class="door hidden" onclick="onDoorClick(6)"><div>üö™ DOOR 6</div><small>Timing Rack</small></div>
      <div id="door7" class="door hidden" onclick="onDoorClick(7)"><div>üö™ DOOR 7</div><small>Shift Bay</small></div>
      <div id="door8" class="door hidden" onclick="onDoorClick(8)"><div>üö™ DOOR 8</div><small>Decoder Slot</small></div>
      <div id="door9" class="door hidden" onclick="onDoorClick(9)"><div>üö™ DOOR 9</div><small>MUX Cabinet</small></div>
      <div id="door10" class="door hidden" onclick="onDoorClick(10)"><div>üö™ DOOR 10</div><small>Final Vault</small></div>
      <div id="door11" class="door hidden" onclick="onDoorClick(11)"><div>üö™ DOOR 11</div><small>Truth Table</small></div>
      <div id="door12" class="door hidden" onclick="onDoorClick(12)"><div>üö™ DOOR 12</div><small>Circuit Board</small></div>
      <div id="door13" class="door hidden" onclick="onDoorClick(13)"><div>üö™ DOOR 13</div><small>Memory Map</small></div>
      <div id="door14" class="door hidden" onclick="onDoorClick(14)"><div>üö™ DOOR 14</div><small>Pipeline Stage</small></div>
      <div id="door15" class="door hidden" onclick="onDoorClick(15)"><div>üö™ DOOR 15</div><small>Master Vault</small></div>
    </div>

    <div id="message">üîç Locate the first door and open it to begin your escape...</div>
    <div id="keys"><span id="keyCount">üîë Keys Collected: 0/15</span><div id="keyShelf" style="margin-top:12px;"></div></div>

    <div class="exit-door" id="exitDoor" onclick="escapeRoom()">üîì FINAL EXIT ‚Äî EMERGENCY UNLOCK üîì</div>

    <div class="victory-screen" id="victoryScreen">
      <h3>üéâ ESCAPE SUCCESSFUL! üéâ</h3>
      <p>You have successfully escaped the DDCO Laboratory!</p>
      <p>All 15 digital keys have been collected. The exit door is open. You are FREE.</p>
      <p id="victoryTime" style="color: #00ffff; font-weight: 700; margin-top: 15px;"></p>
    </div>

    <div class="timeout-screen" id="timeoutScreen">
      <h3>‚è∞ SYSTEM LOCKDOWN ‚è∞</h3>
      <p>Your time has expired. All doors have locked permanently.</p>
      <p>You managed to escape <span id="finalKeys">0</span>/15 rooms before the system sealed.</p>
      <p style="margin-top: 20px;">Better luck next time...</p>
    </div>
  </div>

  <div class="image-puzzle-modal" id="imagePuzzleModal">
    <div class="modal-content">
      <h3 id="modalTitle">üñºÔ∏è Image Puzzle</h3>
      <img id="modalImage" src="" alt="Puzzle" class="modal-image" />
      <p class="modal-question" id="modalQuestion">What's your answer?</p>
      <input type="text" id="imagePuzzleInput" class="modal-input" placeholder="Enter your answer..." />
      <div class="modal-buttons">
        <button class="modal-btn modal-submit" onclick="submitImagePuzzle()">‚úì Submit</button>
        <button class="modal-btn modal-close" onclick="closeImageModal()">‚úï Close</button>
      </div>
    </div>
  </div>

  <div class="npc" id="npc">
    <h4>System Guide</h4>
    <p id="npcText">I will provide guidance after you unlock a door.</p>
    <div class="close" onclick="hideNpc()">‚úñ Close</div>
  </div>

  <script>
    const puzzles = [
      { q: "Binary Puzzle: What is the decimal value of 1011?", check: a => parseInt(a) === 11, lootNote: "a brass key behind a binary poster", clue: "Check the poster near the resistor shelf." },
      { q: "Logic Gate: NOT(OR(0,1,0)) = ?", check: a => parseInt(a) === 0, lootNote: "a copper key under a loose tile", clue: "Look for the loose tile near the bench." },
      { q: "Flip-Flop: If D=1 and you give a rising clock to a D flip-flop, Q becomes ?", check: a => parseInt(a) === 1, lootNote: "an iron key in a flip-flop diagram", clue: "Inspect the timing posters on the wall." },
      { q: "Instruction: MOV R1, #5 ‚Üí What value is in R1?", check: a => parseInt(a) === 5, lootNote: "a silver key inside the manual", clue: "Peek inside the instruction manual on the shelf." },
      { q: "Combinational: XOR(1,0,1) ‚Üí result? (XOR of 3 inputs)", check: a => parseInt(a) === 0, lootNote: "a bronze key near the ALU", clue: "Search the ALU bench for a glint." },
      { q: "Sequential: JK with J=1,K=1 on clock ‚Üí state becomes ?", check: a => ["toggle","toggles","toggled"].includes(String(a).toLowerCase()), lootNote: "an obsidian key behind timing diagrams", clue: "Check behind the timing diagram posters." },
      { q: "Assembly: R2 = 8; execute SHL R2 (shift left by 1). New value?", check: a => parseInt(a) === 16, lootNote: "a crystal key in the ALU shard", clue: "Look near the shift registers on the bench." },
      { q: "Decoder: 2-to-4 decoder input '11' (binary) activates which output 0-3?", check: a => parseInt(a) === 3, lootNote: "an emerald key in a decoder socket", clue: "Inspect any empty decoder sockets." },
      { q: "Multiplexer: 4-to-1 MUX select '10' chooses which input (0-3)?", check: a => parseInt(a) === 2, lootNote: "a sapphire key under a MUX chip", clue: "Slide open the MUX cabinet drawers." },
      { q: "Final Riddle: 8 bits unsigned range 0-255. In 2's complement what's the signed range? (format like: -128 to 127)", check: a => String(a).includes("-128") && String(a).includes("127"), lootNote: "the master key welded to the EXIT DOOR", clue: "The final vault glows ‚Äî inspect the vault plaque." },
      
      // IMAGE PUZZLES (5 new)
      { type: "image", image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='300' viewBox='0 0 500 300'%3E%3Crect fill='%23071a20' width='500' height='300'/%3E%3Ctext x='250' y='35' text-anchor='middle' font-size='24' fill='%2300e5ff' font-weight='bold'%3EAnd Gate Truth Table%3C/text%3E%3Cline x1='40' y1='60' x2='460' y2='60' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='100' y='100' font-size='18' fill='%23cfeee7' font-weight='bold'%3EA  B  Output%3C/text%3E%3Cline x1='40' y1='115' x2='460' y2='115' stroke='%23ffb86b' stroke-width='1'/%3E%3Ctext x='100' y='150' font-size='18' fill='%23cfeee7'%3E0  0    0%3C/text%3E%3Ctext x='100' y='180' font-size='18' fill='%23cfeee7'%3E0  1    0%3C/text%3E%3Ctext x='100' y='210' font-size='18' fill='%23cfeee7'%3E1  0    0%3C/text%3E%3Ctext x='100' y='240' font-size='18' fill='%23ffff00' font-weight='bold'%3E1  1    ?%3C/text%3E%3Cline x1='40' y1='255' x2='460' y2='255' stroke='%23ffb86b' stroke-width='2'/%3E%3C/svg%3E", q: "From the AND gate truth table, what is the output when A=1 and B=1?", check: a => parseInt(a) === 1, lootNote: "a jade key from the truth table vault", clue: "Check the logic analyzer in the corner." },
      
      { type: "image", image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='320' viewBox='0 0 500 320'%3E%3Crect fill='%23071a20' width='500' height='320'/%3E%3Ctext x='250' y='35' text-anchor='middle' font-size='22' fill='%2300e5ff' font-weight='bold'%3E8-Bit Register: Find Bit Value%3C/text%3E%3Cline x1='40' y1='60' x2='460' y2='60' stroke='%23ffb86b' stroke-width='2'/%3E%3Crect x='60' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='80' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E7%3C/text%3E%3Crect x='110' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='130' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E6%3C/text%3E%3Crect x='160' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='180' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E5%3C/text%3E%3Crect x='210' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='230' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E4%3C/text%3E%3Crect x='260' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='280' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E3%3C/text%3E%3Crect x='310' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='330' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E2%3C/text%3E%3Crect x='360' y='90' width='40' height='40' fill='%23ffff00' stroke='%23ffff00' stroke-width='2'/%3E%3Ctext x='380' y='120' text-anchor='middle' font-size='14' fill='%23000' font-weight='bold'%3E2%5E1%3C/text%3E%3Crect x='410' y='90' width='40' height='40' fill='%23333' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='430' y='120' text-anchor='middle' font-size='14' fill='%23cfeee7' font-weight='bold'%3E2%5E0%3C/text%3E%3Ctext x='250' y='170' text-anchor='middle' font-size='16' fill='%23cfeee7'%3ERegister Value: 11010110%3C/text%3E%3Ctext x='250' y='210' text-anchor='middle' font-size='16' fill='%23ffff00'%3EWhat is the value of 2%5E1 (Highlighted)?%3C/text%3E%3C/svg%3E", q: "The highlighted bit represents 2^1. What is 2^1?", check: a => parseInt(a) === 2, lootNote: "a gold key from the register chamber", clue: "Review binary weights on the shelf." },
      
      { type: "image", image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='320' viewBox='0 0 500 320'%3E%3Crect fill='%23071a20' width='500' height='320'/%3E%3Ctext x='250' y='35' text-anchor='middle' font-size='22' fill='%2300e5ff' font-weight='bold'%3EMUX (4-to-1) Selection Table%3C/text%3E%3Cline x1='40' y1='60' x2='460' y2='60' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='100' y='100' font-size='16' fill='%23cfeee7' font-weight='bold'%3ES1  S0  Output%3C/text%3E%3Cline x1='40' y1='115' x2='460' y2='115' stroke='%23ffb86b' stroke-width='1'/%3E%3Ctext x='100' y='150' font-size='16' fill='%23cfeee7'%3E0   0   I0%3C/text%3E%3Ctext x='100' y='180' font-size='16' fill='%23cfeee7'%3E0   1   I1%3C/text%3E%3Ctext x='100' y='210' font-size='16' fill='%23cfeee7'%3E1   0   I2%3C/text%3E%3Ctext x='100' y='240' font-size='16' fill='%23ffff00' font-weight='bold'%3E1   1   ?%3C/text%3E%3Cline x1='40' y1='255' x2='460' y2='255' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='250' y='290' text-anchor='middle' font-size='15' fill='%23ffff00'%3EWhen S1=1, S0=1, which input is selected?%3C/text%3E%3C/svg%3E", q: "When S1=1 and S0=1, which input (I0, I1, I2, or I3) is selected? Type just the name (e.g., I3)", check: a => String(a).toLowerCase() === "i3", lootNote: "a platinum key from the multiplexer nest", clue: "Check selector diagrams near control panel." },
      
      { type: "image", image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='300' viewBox='0 0 500 300'%3E%3Crect fill='%23071a20' width='500' height='300'/%3E%3Ctext x='250' y='35' text-anchor='middle' font-size='22' fill='%2300e5ff' font-weight='bold'%3E4-Bit Counter Sequence%3C/text%3E%3Cline x1='40' y1='60' x2='460' y2='60' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='120' y='100' font-size='16' fill='%23cfeee7' font-weight='bold'%3EStep  Binary Value%3C/text%3E%3Cline x1='40' y1='115' x2='460' y2='115' stroke='%23ffb86b' stroke-width='1'/%3E%3Ctext x='120' y='150' font-size='16' fill='%23cfeee7'%3E0      0000%3C/text%3E%3Ctext x='120' y='180' font-size='16' fill='%23cfeee7'%3E1      0001%3C/text%3E%3Ctext x='120' y='210' font-size='16' fill='%23cfeee7'%3E2      0010%3C/text%3E%3Ctext x='120' y='240' font-size='16' fill='%23ffff00' font-weight='bold'%3E3      ????%3C/text%3E%3Cline x1='40' y1='255' x2='460' y2='255' stroke='%23ffb86b' stroke-width='2'/%3E%3C/svg%3E", q: "In a 4-bit binary counter, after 0000, 0001, 0010, what comes next? (Step 3 in binary)", check: a => String(a) === "0011", lootNote: "a diamond key from the counter chamber", clue: "Study binary increment patterns." },
      
      { type: "image", image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='340' viewBox='0 0 500 340'%3E%3Crect fill='%23071a20' width='500' height='340'/%3E%3Ctext x='250' y='35' text-anchor='middle' font-size='22' fill='%2300e5ff' font-weight='bold'%3E2%27s Complement Range Table%3C/text%3E%3Cline x1='40' y1='60' x2='460' y2='60' stroke='%23ffb86b' stroke-width='2'/%3E%3Ctext x='100' y='100' font-size='16' fill='%23cfeee7' font-weight='bold'%3E Bits    Min    Max%3C/text%3E%3Cline x1='40' y1='115' x2='460' y2='115' stroke='%23ffb86b' stroke-width='1'/%3E%3Ctext x='100' y='150' font-size='16' fill='%23cfeee7'%3E  4     -8     7%3C/text%3E%3Ctext x='100' y='180' font-size='16' fill='%23cfeee7'%3E  8    -128   127%3C/text%3E%3Ctext x='100' y='210' font-size='16' fill='%23ffff00' font-weight='bold'%3E 16     ???   ????%3C/text%3E%3Cline x1='40' y1='225' x2='460' y2='225' stroke='%23ffb86b' stroke-width='1'/%3E%3Ctext x='250' y='270' text-anchor='middle' font-size='15' fill='%23ffff00'%3EFor 16-bit 2%27s complement:%3C/text%3E%3Ctext x='250' y='295' text-anchor='middle' font-size='14' fill='%23ffff00'%3EEnter MIN value (negative number)%3C/text%3E%3Ctext x='250' y='320' text-anchor='middle' font-size='13' fill='%2300ffff'%3E(Pattern: -2^(n-1))%3C/text%3E%3C/svg%3E", q: "For 16-bit 2's complement, what is the MINIMUM value? (Pattern: -2^(n-1))", check: a => parseInt(a) === -32768, lootNote: "the ruby key from the final vault", clue: "Check the binary range chart." }
    ];

    let keysCollected = 0;
    let timeRemaining = 900; // 15 minutes
    let timerInterval = null;
    let gameActive = false;
    let currentImagePuzzleDoor = null;

    function startTimer() {
      gameActive = true;
      timerInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        if (timeRemaining <= 0) gameOver();
      }, 1000);
    }

    function updateTimerDisplay() {
      const timerEl = document.getElementById("timer");
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      timerEl.innerText = `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;

      if (timeRemaining <= 60) {
        timerEl.classList.add("danger");
        timerEl.classList.remove("warning");
      } else if (timeRemaining <= 300) {
        timerEl.classList.add("warning");
        timerEl.classList.remove("danger");
      } else {
        timerEl.classList.remove("warning", "danger");
      }
    }

    function gameOver() {
      gameActive = false;
      clearInterval(timerInterval);
      document.getElementById("gameContainer").style.display = "none";
      document.getElementById("timeoutScreen").style.display = "block";
      document.getElementById("finalKeys").innerText = keysCollected;
    }

    function startGame() {
      document.getElementById("introScreen").style.display = "none";
      document.getElementById("gameContainer").style.display = "block";
      document.getElementById("message").innerText = "üîç The laboratory door opens. The first puzzle awaits. ‚è∞ Timer activated!";
      document.getElementById("door1").classList.add("pulse");
      startTimer();
    }

    function onDoorClick(doorNum) {
      if (!gameActive) {
        alert("‚è∞ System is locked. Game over.");
        return;
      }

      const doorEl = document.getElementById(`door${doorNum}`);
      if (doorEl.classList.contains("unlocked")) {
        document.getElementById("message").innerText = `‚úÖ Door ${doorNum} is already unlocked.`;
        showNpc(`You've already solved Door ${doorNum}. Next: ${getNextClue(doorNum)}`);
        return;
      }

      const open = confirm("üö™ Attempt to unlock this door?");
      if (!open) {
        document.getElementById("message").innerText = "üîí You step back...";
        return;
      }

      const p = puzzles[doorNum - 1];
      if (!p) {
        alert("‚ö†Ô∏è Empty chamber.");
        return;
      }

      if (p.type === "image") {
        currentImagePuzzleDoor = doorNum;
        document.getElementById("modalTitle").innerText = `üñºÔ∏è Door ${doorNum} - Image Puzzle`;
        document.getElementById("modalImage").src = p.image;
        document.getElementById("modalQuestion").innerText = p.q;
        document.getElementById("imagePuzzleInput").value = "";
        document.getElementById("imagePuzzleModal").classList.add("show");
        return;
      }

      let attempt = prompt(`${p.q}`);
      if (attempt === null) {
        document.getElementById("message").innerText = "üîí Puzzle abandoned.";
        return;
      }

      let ok = false;
      try { ok = p.check(attempt); } catch(e){ ok = false; }

      if (ok) {
        unlockDoor(doorNum);
        showNpc(`‚ú® Correct! You found ${p.lootNote}.\n\nüìç ${p.clue}`);
      } else {
        const tries = doorEl.dataset.tries ? parseInt(doorEl.dataset.tries) + 1 : 1;
        doorEl.dataset.tries = tries;
        const nudges = ["‚ùå Incorrect. Analyze more carefully.", "‚ùå Think again.", "‚ùå Review the fundamentals."];
        const nudge = nudges[Math.min(tries-1, nudges.length-1)];
        alert(nudge);
        document.getElementById("message").innerText = `üîí Door ${doorNum} sealed. ${nudge}`;
      }
    }

    function submitImagePuzzle() {
      if (currentImagePuzzleDoor === null) return;
      const attempt = document.getElementById("imagePuzzleInput").value;
      const p = puzzles[currentImagePuzzleDoor - 1];
      let ok = false;
      try { ok = p.check(attempt); } catch(e){ ok = false; }

      if (ok) {
        closeImageModal();
        unlockDoor(currentImagePuzzleDoor);
        showNpc(`‚ú® Correct! You found ${p.lootNote}.\n\nüìç ${p.clue}`);
      } else {
        alert("‚ùå Incorrect. Analyze the image more carefully.");
      }
    }

    function closeImageModal() {
      document.getElementById("imagePuzzleModal").classList.remove("show");
      currentImagePuzzleDoor = null;
    }

    function unlockDoor(doorNum) {
      const doorEl = document.getElementById(`door${doorNum}`);
      doorEl.classList.add("unlocked");
      doorEl.classList.remove("pulse");

      const next = document.getElementById(`door${doorNum + 1}`);
      if (next) {
        next.classList.remove("hidden");
        next.classList.add("pulse");
      }

      keysCollected++;
      document.getElementById("keyCount").innerText = `üîë Keys Collected: ${keysCollected}/15`;
      addKeyIcon(keysCollected);

      document.getElementById("message").innerText = `‚úÖ DOOR ${doorNum} UNLOCKED! üéØ ${keysCollected}/15 keys collected.`;

      if (keysCollected === 15) {
        gameActive = false;
        clearInterval(timerInterval);
        document.getElementById("exitDoor").style.display = "block";
        document.getElementById("exitDoor").classList.add("pulse");
        showNpc("üéâ All keys collected! Master exit accessible. Escape now!");
      }
    }

    function addKeyIcon(idx) {
      const keyShelf = document.getElementById("keyShelf");
      const span = document.createElement("span");
      span.className = "key-icon";
      const emojis = ["üîë","üóùÔ∏è","üîê","üß©","üí†","‚öôÔ∏è","üî∏","üîπ","‚≠ê","üèÜ","üíé","üî±","üëë","üåü","‚ö°"];
      span.innerText = emojis[(idx-1) % emojis.length];
      span.title = `Key ${idx}`;
      keyShelf.appendChild(span);
    }

    function showNpc(text) {
      document.getElementById("npcText").innerText = text;
      document.getElementById("npc").style.display = "block";
    }

    function hideNpc() { document.getElementById("npc").style.display = "none"; }

    function getNextClue(doorNum) {
      const next = puzzles[doorNum] || null;
      return next ? next.clue : "The lab awaits.";
    }

    function escapeRoom() {
      if (!gameActive) return;
      gameActive = false;
      clearInterval(timerInterval);
      const ok = confirm("üö™ Activate master override and escape?");
      if (!ok) {
        gameActive = true;
        startTimer();
        return;
      }
      document.getElementById("gameContainer").style.display = "none";
      document.getElementById("victoryScreen").style.display = "block";
      const mins = Math.floor((900 - timeRemaining) / 60);
      const secs = (900 - timeRemaining) % 60;
      document.getElementById("victoryTime").innerText = `üèÉ Escaped in ${mins}:${secs.toString().padStart(2, '0')}! üèÅ`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      for (let i = 2; i <= 15; i++) document.getElementById(`door${i}`).classList.add('hidden');
    });
  </script>
</body>
</html>