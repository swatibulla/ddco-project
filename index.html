<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Decode & Discover ‚Äî 15 Puzzles</title>
<style>
  :root{
    --bg1:#0b1220;
    --bg2:#071020;
    --electric:#00b3ff;
    --accent:#00aaff;
    --panel: rgba(0,0,0,0.82);
    --input-bg: rgba(0,51,102,0.92);
    --hint: #ffda79;
    --text: #e6f7ff;
  }
  html,body{height:100%;margin:0}
  body{
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--text);
    font-family: "Inter", Arial, sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:28px;
    box-sizing:border-box;
  }
  h1{
    margin:6px 0 12px 0;
    color:var(--electric);
    font-size:34px;
    letter-spacing:1px;
    text-shadow: 0 0 12px rgba(0,179,255,0.25);
    font-weight:700;
  }
  #instructions{
    width:820px;
    max-width:94%;
    background:var(--panel);
    border:2px solid var(--accent);
    padding:14px 18px;
    border-radius:12px;
    text-align:left;
    line-height:1.4;
    margin-bottom:14px;
  }
  #timer{
    margin:10px 0;
    color:var(--hint);
    font-weight:600;
  }
  #questionBox{
    width:820px;
    max-width:94%;
    background: linear-gradient(180deg, rgba(0,0,0,0.62), rgba(6,12,20,0.6));
    border-radius:12px;
    border:2px solid rgba(0,163,255,0.15);
    padding:22px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    text-align:left;
    color:var(--text);
    font-size:18px;
    margin-bottom:12px;
  }
  #questionText{ font-size:20px; margin-bottom:12px; }
  #answerRow{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  input#answer {
    flex:1 1 420px;
    padding:12px 14px;
    font-size:17px;
    border-radius:8px;
    border:2px solid var(--electric);
    background:var(--input-bg);
    color:var(--text);
  }
  button#submitBtn{
    padding:12px 18px;
    background: linear-gradient(90deg,var(--electric),#00f0a0);
    border:none;
    color:#002;
    font-weight:700;
    border-radius:8px;
    cursor:pointer;
  }
  button#startBtn{
    padding:12px 20px;
    background:var(--electric);
    border:none;
    color:#001;
    font-weight:700;
    border-radius:8px;
    cursor:pointer;
    margin-top:8px;
  }
  #feedback { margin-top:12px; color:var(--hint); min-height:26px; }
  .small { font-size:14px; color:#bfefff; opacity:0.9; }
  .muted { color:#9ac7df; font-size:13px }
  .correct-answer { color:#8fffb0; font-weight:700; }
  footer{ margin-top:16px; color:#9ac7df; font-size:13px; }
  @media (max-width:520px){
    h1{font-size:28px}
    #questionText{font-size:18px}
  }
</style>
</head>
<body>

<h1>DECODE & DISCOVER</h1>

<div id="instructions">
  <strong>How to play</strong><br>
  ‚Ä¢ There are <strong>15</strong> questions. Answer them one-by-one in order. <br>
  ‚Ä¢ You have <strong>3 attempts</strong> per question. After the 2nd wrong try you get a hint. After the 3rd wrong try the correct answer is shown and the game automatically moves to the next question. (Option A behavior.)<br>
  ‚Ä¢ Timer: <strong>10 minutes</strong>. When time runs out the page will reload. <br>
  ‚Ä¢ Answers are checked case-insensitively and punctuation/extra spaces are ignored. Puzzle #9 accepts several common forms (e.g. <code>exit0</code>, <code>exit(0)</code>, etc.).<br>
</div>

<div id="timer">Time Left: 10:00</div>

<div id="questionBox" style="display:none">
  <div id="questionText"></div>
  <div id="answerRow">
    <input id="answer" autocomplete="off" placeholder="Type your answer here" />
    <button id="submitBtn">Submit</button>
  </div>
  <div id="feedback" aria-live="polite"></div>
  <div class="small muted" id="progress"></div>
</div>

<button id="startBtn">Start</button>

<footer>Made for your escape room ‚Äî responsive, stable, zero skipping.</footer>

<script>
/* -------------------------
   Puzzle list (15 puzzles)
   -------------------------
   Each puzzle: { q: question text, a: array of accepted answers (normalized), hint: hint text }
*/
const puzzles = [
  { q: "1) NOT(OR(0,1,0)) = ?", a: ["0"], hint: "OR yields 1 if any input is 1." },
  { q: "2) Decimal value of 1011?", a: ["11"], hint: "Binary to decimal: 8+0+2+1." },
  { q: "3) A full adder has how many inputs?", a: ["3"], hint: "A, B and carry-in." },
  { q: "4) I open only when every switch is ON. What am I?", a: ["and"], hint: "All inputs must be 1." },
  { q: "5) If two inputs differ I output 1. Who am I?", a: ["xor"], hint: "Exclusive OR." },
  { q: "6) I speak only when both are silent. Who am I?", a: ["nor"], hint: "Opposite of OR." },
  { q: "7) Where do C programs begin?", a: ["main"], hint: "The entry function." },
  { q: "8) I call myself until the work is done. What is this?", a: ["recursion"], hint: "A function calling itself." },

  // Puzzle 9 accepts multiple common forms
  { q: "9) I end the program instantly. Which command? (C)", 
    a: ["exit0","exit(0)","exit 0","exit(0);","exit 0;"], 
    hint: "Common C exit forms: exit(0) or exit 0." },

  { q: "10) Conversion from one data type to another is called?", a: ["typecasting", "casting"], hint: "E.g., (int) or (float)." },

  // 11‚Äì15 updated as user specified earlier
  { q: "11) Light as a feather, yet no man can hold me for long. What am I?", a: ["breath"], hint: "You breathe it." },
  { q: "12) The more of me there is, the less you see. What am I?", a: ["darkness"], hint: "Opposite of light." },
  { q: "13) Find the next number: 2, 6, 12, 20, ? (Pattern n(n+1) ‚Äî 1¬∑2,2¬∑3,3¬∑4,...)", a: ["30"], hint: "This is n(n+1): next is 5¬∑6 = 30." },
  { q: "14) Which language popularized the phrase ‚Äúwrite once, run anywhere‚Äù?", a: ["java"], hint: "Runs on the JVM." },
  { q: "15) Magic square 3√ó3 using 1‚Äì9, all rows/cols/diagonals sum 15. Center number?", a: ["5"], hint: "Center of 3√ó3 magic square is 5." }
];

/* -------------------------
   State
   ------------------------- */
let current = 0;          // index into puzzles
let attempts = 0;         // attempts for current question
let timerSeconds = 10 * 60; // 10 minutes
let timerInterval = null;
let advancing = false;    // lock while auto-advancing to prevent double clicks

/* -------------------------
   Utilities: normalization
   - lowercase
   - strip punctuation except alphanumerics
   - remove multiple spaces
   - also special-case to remove trailing semicolon
   ------------------------- */
function normalizeAnswer(s){
  if(!s) return "";
  s = String(s).trim().toLowerCase();
  // remove trailing semicolons/spaces
  s = s.replace(/;$/,'').trim();
  // collapse spaces
  s = s.replace(/\s+/g,' ');
  // remove punctuation except parentheses for forms like exit(0)
  // but also produce a variant without punctuation for matching e.g. "exit 0" -> "exit0"
  return s;
}

function canonicalForms(s){
  // returns a set of normalized forms for a user input to compare against accepted answers
  const norm = normalizeAnswer(s);
  const noSpaces = norm.replace(/\s+/g,'');
  const stripPunct = norm.replace(/[^a-z0-9\(\)]/g,''); // keep parentheses if any
  return new Set([norm, noSpaces, stripPunct]);
}

/* -------------------------
   Rendering
   ------------------------- */
const qBox = document.getElementById("questionBox");
const qText = document.getElementById("questionText");
const answerInput = document.getElementById("answer");
const submitBtn = document.getElementById("submitBtn");
const feedbackEl = document.getElementById("feedback");
const progressEl = document.getElementById("progress");
const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");

function renderCurrent(){
  advancing = false;
  attempts = 0;
  feedbackEl.textContent = "";
  answerInput.value = "";
  answerInput.disabled = false;
  submitBtn.disabled = false;

  if(current >= puzzles.length){
    qBox.style.display = "block";
    qText.innerHTML = "<strong>üéâ All done ‚Äî congratulations!</strong>";
    document.getElementById("answerRow").style.display = "none";
    feedbackEl.innerHTML = "";
    progressEl.innerText = `Completed ${puzzles.length}/${puzzles.length}`;
    return;
  }

  const p = puzzles[current];
  qBox.style.display = "block";
  qText.innerText = p.q;
  progressEl.innerText = `Question ${current+1} of ${puzzles.length}`;
  // focus input
  setTimeout(()=> answerInput.focus(), 50);
}

/* -------------------------
   Timer
   ------------------------- */
function startTimer(){
  timerEl.textContent = formatTime(timerSeconds);
  timerInterval = setInterval(()=>{
    timerSeconds--;
    timerEl.textContent = formatTime(timerSeconds);
    if(timerSeconds <= 0){
      clearInterval(timerInterval);
      alert("Time's up! The page will reload.");
      location.reload();
    }
  },1000);
}
function formatTime(sec){
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return `Time Left: ${m}:${s}`;
}

/* -------------------------
   Answer checking logic (Option A)
   - on correct -> advance to next
   - on 1st wrong -> message
   - on 2nd wrong -> show hint
   - on 3rd wrong -> reveal correct, auto advance after delay
   Ensure no skipping: advancing flag prevents double events
   ------------------------- */
function checkAnswer(){
  if(advancing) return;
  const raw = answerInput.value;
  const userForms = canonicalForms(raw);

  const p = puzzles[current];
  // build set of normalized accepted answers
  const accepted = new Set();
  for(const a of p.a){
    const af = normalizeAnswer(a);
    accepted.add(af);
    accepted.add(af.replace(/\s+/g,'')); // no spaces
    accepted.add(af.replace(/[^a-z0-9\(\)]/g,'')); // strip punctuation except parens
  }

  // check intersection
  let matched = false;
  for(const form of userForms){
    if(accepted.has(form)) { matched = true; break; }
  }

  attempts++;

  if(matched){
    // correct answer
    feedbackEl.innerHTML = `<span class="correct-answer">‚úÖ Correct.</span>`;
    // disable input briefly and advance after small delay so user sees feedback
    advancing = true;
    answerInput.disabled = true;
    submitBtn.disabled = true;
    setTimeout(()=> {
      current++;
      renderCurrent();
    }, 600);
    return;
  }

  // incorrect branch
  if(attempts === 1){
    feedbackEl.innerHTML = `‚ùå Incorrect ‚Äî try again.`;
  } else if(attempts === 2){
    feedbackEl.innerHTML = `‚ùå Incorrect ‚Äî <strong>Hint:</strong> ${p.hint}`;
  } else {
    // 3rd wrong attempt -> reveal correct answer(s), then auto-advance
    // show first accepted answer in readable form
    const shown = Array.isArray(p.a) ? p.a[0] : p.a;
    feedbackEl.innerHTML = `‚ùå Incorrect ‚Äî Correct: <span class="correct-answer">${shown}</span><br>Moving to next...`;
    advancing = true;
    answerInput.disabled = true;
    submitBtn.disabled = true;
    setTimeout(()=>{
      current++;
      renderCurrent();
    }, 1200); // 1.2s as requested
  }
}

/* -------------------------
   Start handler & wiring
   ------------------------- */
startBtn.addEventListener("click", ()=>{
  startBtn.style.display = "none";
  renderCurrent();
  startTimer();
});
submitBtn.addEventListener("click", checkAnswer);
answerInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") checkAnswer();
});

/* Accessibility: prevent accidental double-clicks by disabling on submit; handled in checkAnswer */
</script>
</body>
</html>
