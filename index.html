<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DDCO Escape Room</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #071018;
      color: #cfeee7;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-top: 20px;
      font-size: 40px;
      color: #fff;
      text-shadow: 0 0 18px rgba(0,200,255,0.35);
    }
    #timer {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 28px;
      font-weight: 700;
      color: #00ff00;
      background: rgba(0, 0, 0, 0.8);
      padding: 12px 20px;
      border-radius: 10px;
      border: 2px solid #00ff00;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
      z-index: 999;
    }
    #timer.warning {
      color: #ffff00;
      border-color: #ffff00;
      box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
    }
    #timer.danger {
      color: #ff0000;
      border-color: #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
      animation: blink 0.5s infinite;
    }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .intro-screen {
      margin: 30px auto;
      padding: 28px;
      border: 2px solid #00e5ff;
      background: linear-gradient(180deg, rgba(0,230,255,0.04), rgba(0,0,0,0.25));
      border-radius: 12px;
      font-size: 18px;
      line-height: 1.6;
      width: 92%;
      max-width: 820px;
    }
    .start-button {
      margin-top: 18px;
      padding: 12px 28px;
      font-size: 20px;
      background-color: #00e5ff;
      color: #012;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
    }
    .game-container { display: none; margin-top: 12px; }
    #game { display:flex; flex-wrap:wrap; justify-content:center; gap:14px; margin-top:12px; }
    .door {
      width: 160px;
      height: 110px;
      margin: 8px;
      padding: 10px;
      border: 3px solid #ffb86b;
      display: inline-flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      cursor: pointer;
      background-color: #071a20;
      border-radius: 10px;
      font-size: 18px;
      color: #ffe8c9;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .door:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
    .door.hidden { display: none; }
    .door.unlocked {
      background: linear-gradient(180deg,#0af3a3,#02785f);
      color: #02120f;
      border-color: #00ffb3;
      box-shadow: 0 10px 30px rgba(0,255,176,0.12);
      transform: none;
      cursor: default;
    }
    #message { margin-top: 18px; font-size: 18px; min-height:44px; }
    #keys { margin-top: 12px; font-size: 18px; color: #ffd36b; }
    .key-icon { display:inline-block; margin:0 6px; font-size:20px; }
    .npc {
      position: fixed;
      left: 18px;
      bottom: 18px;
      background: rgba(3,18,26,0.95);
      color: #dff9f3;
      border: 2px solid #00c6ff;
      padding: 12px 14px;
      border-radius: 12px;
      max-width: 320px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      display: none;
      z-index: 200;
    }
    .npc h4 { margin: 0 0 6px 0; font-size:16px; color:#bff7ff; }
    .npc p { margin: 0; font-size:14px; color:#eafefb; line-height:1.4; }
    .npc .close { margin-top: 8px; display:block; text-align:right; font-size:13px; color:#9be8ff; cursor:pointer; }
    .pulse { animation: pulse 1.2s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 8px rgba(0,190,255,0.12); } 50% { box-shadow: 0 0 28px rgba(0,190,255,0.22); } 100% { box-shadow:0 0 8px rgba(0,190,255,0.12); } }
    .exit-door {
      margin-top: 20px;
      padding: 20px;
      border: 3px dashed #ff7bff;
      background: linear-gradient(180deg, rgba(255,123,255,0.04), rgba(0,0,0,0.2));
      border-radius: 10px;
      font-size: 20px;
      display:none;
      cursor:pointer;
    }
    .victory-screen { display:none; padding:28px; margin-top:16px; border:2px solid #ffd36b; border-radius:10px; background:#07121a; color:#fff; }
    .timeout-screen { display:none; padding:28px; margin-top:16px; border:2px solid #ff0000; border-radius:10px; background:#07121a; color:#ff0000; text-align: center; }
  </style>
</head>
<body>
  <h1>ğŸ” DDCO ESCAPE ROOM ğŸ”</h1>

  <div id="timer">â±ï¸ 10:00</div>

  <div class="intro-screen" id="introScreen">
    <p><strong>You are entering the DDCO Escape Room!</strong></p>
    <p>10 doors. 10 riddles. 10 keys. You have 10 minutes to escape!</p>
    <p>Click a visible door, choose to open it, solve the riddle to claim the key â€” then listen to the guide.</p>
    <button class="start-button" onclick="startGame()">ğŸšª Start Adventure</button>
  </div>

  <div class="game-container" id="gameContainer">
    <div id="game">
      <div id="door1" class="door" onclick="onDoorClick(1)"><div>ğŸšª Door 1</div><small>Binary Corner</small></div>
      <div id="door2" class="door hidden" onclick="onDoorClick(2)"><div>ğŸšª Door 2</div><small>Logic Shelf</small></div>
      <div id="door3" class="door hidden" onclick="onDoorClick(3)"><div>ğŸšª Door 3</div><small>Flip-Flop Wall</small></div>
      <div id="door4" class="door hidden" onclick="onDoorClick(4)"><div>ğŸšª Door 4</div><small>Instruction Nook</small></div>
      <div id="door5" class="door hidden" onclick="onDoorClick(5)"><div>ğŸšª Door 5</div><small>ALU Bench</small></div>
      <div id="door6" class="door hidden" onclick="onDoorClick(6)"><div>ğŸšª Door 6</div><small>Timing Rack</small></div>
      <div id="door7" class="door hidden" onclick="onDoorClick(7)"><div>ğŸšª Door 7</div><small>Shift Bay</small></div>
      <div id="door8" class="door hidden" onclick="onDoorClick(8)"><div>ğŸšª Door 8</div><small>Decoder Slot</small></div>
      <div id="door9" class="door hidden" onclick="onDoorClick(9)"><div>ğŸšª Door 9</div><small>MUX Cabinet</small></div>
      <div id="door10" class="door hidden" onclick="onDoorClick(10)"><div>ğŸšª Door 10</div><small>Final Vault</small></div>
    </div>

    <div id="message">Find the first door to begin.</div>
    <div id="keys"><span id="keyCount">ğŸ”‘ Keys Collected: 0/10</span><div id="keyShelf" style="margin-top:8px;"></div></div>

    <div class="exit-door" id="exitDoor" onclick="escapeRoom()">ğŸ”“ FINAL EXIT DOOR â€” Click to Escape!</div>

    <div class="victory-screen" id="victoryScreen">
      <h3>ğŸ‰ Escape Successful!</h3>
      <p>You collected all keys and escaped the DDCO Escape Room. Well played.</p>
      <p id="victoryTime"></p>
    </div>

    <div class="timeout-screen" id="timeoutScreen">
      <h3>â° Time's Up!</h3>
      <p>You ran out of time. The doors have locked forever.</p>
      <p>You escaped <span id="finalKeys">0</span>/10 rooms.</p>
    </div>
  </div>

  <div class="npc" id="npc">
    <h4>Guide</h4>
    <p id="npcText">I'll help you after you unlock a door.</p>
    <div class="close" onclick="hideNpc()">âœ– Close</div>
  </div>

  <script>
    // ...existing code...
    const puzzles = [
      { q: "Binary Puzzle: What is the decimal value of 1011?", check: a => parseInt(a) === 11, lootNote: "a brass key behind a binary poster", clue: "Check the poster near the resistor shelf." },
      { q: "Logic Gate: NOT(OR(0,1,0)) = ?", check: a => parseInt(a) === 0, lootNote: "a copper key under a loose tile", clue: "Look for the loose tile near the bench." },
      { q: "Flip-Flop: If D=1 and you give a rising clock to a D flip-flop, Q becomes ?", check: a => parseInt(a) === 1, lootNote: "an iron key in a flip-flop diagram", clue: "Inspect the timing posters on the wall." },
      { q: "Instruction: MOV R1, #5 â†’ What value is in R1?", check: a => parseInt(a) === 5, lootNote: "a silver key inside the manual", clue: "Peek inside the instruction manual on the shelf." },
      { q: "Combinational: XOR(1,0,1) â†’ result? (XOR of 3 inputs)", check: a => parseInt(a) === 0, lootNote: "a bronze key near the ALU", clue: "Search the ALU bench for a glint." },
      { q: "Sequential: JK with J=1,K=1 on clock â†’ state becomes ?", check: a => ["toggle","toggles","toggled"].includes(String(a).toLowerCase()), lootNote: "an obsidian key behind timing diagrams", clue: "Check behind the timing diagram posters." },
      { q: "Assembly: R2 = 8; execute SHL R2 (shift left by 1). New value?", check: a => parseInt(a) === 16, lootNote: "a crystal key in the ALU shard", clue: "Look near the shift registers on the bench." },
      { q: "Decoder: 2-to-4 decoder input '11' (binary) activates which output 0-3?", check: a => parseInt(a) === 3, lootNote: "an emerald key in a decoder socket", clue: "Inspect any empty decoder sockets." },
      { q: "Multiplexer: 4-to-1 MUX select '10' chooses which input (0-3)?", check: a => parseInt(a) === 2, lootNote: "a sapphire key under a MUX chip", clue: "Slide open the MUX cabinet drawers." },
      { q: "Final Riddle: 8 bits unsigned range 0-255. In 2's complement what's the signed range? (format like: -128 to 127)", check: a => String(a).includes("-128") && String(a).includes("127"), lootNote: "the master key welded to the EXIT DOOR", clue: "The final vault glows â€” inspect the vault plaque." }
    ];

    let keysCollected = 0;
    let timeRemaining = 600; // 10 minutes in seconds
    let timerInterval = null;
    let gameActive = false;

    function startTimer() {
      gameActive = true;
      timerInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();

        if (timeRemaining <= 0) {
          gameOver();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const timerEl = document.getElementById("timer");
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      const timeStr = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}`;
      timerEl.innerText = timeStr;

      // Change color based on time remaining
      if (timeRemaining <= 60) {
        timerEl.classList.add("danger");
        timerEl.classList.remove("warning");
      } else if (timeRemaining <= 180) {
        timerEl.classList.add("warning");
        timerEl.classList.remove("danger");
      } else {
        timerEl.classList.remove("warning", "danger");
      }
    }

    function gameOver() {
      gameActive = false;
      clearInterval(timerInterval);
      document.getElementById("gameContainer").style.display = "none";
      document.getElementById("timeoutScreen").style.display = "block";
      document.getElementById("finalKeys").innerText = keysCollected;
    }

    function startGame() {
      document.getElementById("introScreen").style.display = "none";
      document.getElementById("gameContainer").style.display = "block";
      document.getElementById("message").innerText = "You step into the room. The first door glows faintly â€” open it to begin. â° Timer started!";
      document.getElementById("door1").classList.add("pulse");
      startTimer();
    }

    function onDoorClick(doorNum) {
      if (!gameActive) {
        alert("Time is up! Game over.");
        return;
      }

      const doorEl = document.getElementById(`door${doorNum}`);
      if (doorEl.classList.contains("unlocked")) {
        document.getElementById("message").innerText = `Door ${doorNum} is already open. Check for clues or the guide.`;
        showNpc(`You've already opened Door ${doorNum}. Next clue: ${getNextClue(doorNum)}`);
        return;
      }

      const open = confirm("You are entering the escape room now. Open this door?");
      if (!open) {
        document.getElementById("message").innerText = "You step back... maybe open it later.";
        return;
      }

      const p = puzzles[doorNum - 1];
      if (!p) {
        alert("This door seems empty.");
        return;
      }

      let attempt = prompt(`${p.q}`);
      if (attempt === null) { document.getElementById("message").innerText = "You close the door without answering."; return; }

      let ok = false;
      try { ok = p.check(attempt); } catch(e){ ok = false; }

      if (ok) {
        unlockDoor(doorNum);
        showNpc(`Nice! You found ${p.lootNote}. Clue: ${p.clue}`);
      } else {
        const tries = doorEl.dataset.tries ? parseInt(doorEl.dataset.tries) + 1 : 1;
        doorEl.dataset.tries = tries;
        const nudges = [
          "Not quite. Try again.",
          "Keep thinking. You can solve this.",
          "Think harder about the logic."
        ];
        const nudge = nudges[Math.min(tries-1, nudges.length-1)];
        alert(nudge);
        document.getElementById("message").innerText = `Door ${doorNum} remains closed. ${nudge}`;
      }
    }

    function unlockDoor(doorNum) {
      const doorEl = document.getElementById(`door${doorNum}`);
      doorEl.classList.add("unlocked");
      doorEl.classList.remove("pulse");
      doorEl.style.cursor = "default";

      const next = document.getElementById(`door${doorNum + 1}`);
      if (next) {
        next.classList.remove("hidden");
        next.classList.add("pulse");
      }

      keysCollected++;
      document.getElementById("keyCount").innerText = `ğŸ”‘ Keys Collected: ${keysCollected}/10`;
      addKeyIcon(keysCollected);

      document.getElementById("message").innerText = `âœ… Door ${doorNum} unlocked! You found a key. Listen for the guide's hint.`;

      if (keysCollected === 10) {
        gameActive = false;
        clearInterval(timerInterval);
        document.getElementById("exitDoor").style.display = "block";
        document.getElementById("exitDoor").classList.add("pulse");
        showNpc("All keys collected â€” the EXIT DOOR is revealed. Open it to escape.");
      }
    }

    function addKeyIcon(idx) {
      const keyShelf = document.getElementById("keyShelf");
      const span = document.createElement("span");
      span.className = "key-icon";
      const emojis = ["ğŸ”‘","ğŸ—ï¸","ğŸ”","ğŸ§©","ğŸ’ ","âš™ï¸","ğŸ”¸","ğŸ”¹","â­","ğŸ†"];
      span.innerText = emojis[(idx-1) % emojis.length];
      span.title = `Key ${idx}`;
      keyShelf.appendChild(span);
    }

    function showNpc(text) {
      const npc = document.getElementById("npc");
      const t = document.getElementById("npcText");
      t.innerText = text;
      npc.style.display = "block";
    }
    function hideNpc() { document.getElementById("npc").style.display = "none"; }

    function getNextClue(doorNum) {
      const next = puzzles[doorNum] || null;
      return next ? next.clue : "Search the room thoroughly.";
    }

    function escapeRoom() {
      if (!gameActive) return;
      gameActive = false;
      clearInterval(timerInterval);
      const ok = confirm("Use the master key to open the EXIT DOOR and escape?");
      if (!ok) {
        gameActive = true;
        startTimer();
        return;
      }
      document.getElementById("gameContainer").style.display = "none";
      document.getElementById("victoryScreen").style.display = "block";
      const mins = Math.floor((600 - timeRemaining) / 60);
      const secs = (600 - timeRemaining) % 60;
      document.getElementById("victoryTime").innerText = `You escaped in ${mins}:${secs.toString().padStart(2, '0')}!`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      for (let i = 2; i <= 10; i++) document.getElementById(`door${i}`).classList.add('hidden');
    });
    // ...existing code...
  </script>
</body>
</html>